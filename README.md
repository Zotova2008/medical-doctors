# Medical Doctors Directory Theme

WordPress тема с кастомным типом записей "Доктор", таксономиями, мета-полями и функционалом фильтрации.

## Требования

- WordPress 6.x+
- PHP 7.4+
- Не требуется дополнительных плагинов (работает без ACF)

## Установка

1. Скачайте и распакуйте архив темы
2. Поместите папку `medical-doctors-theme` в `wp-content/themes/`
3. Активируйте тему в админ-панели: Внешний вид → Темы

## Структура темы

medical-doctors-theme/

style.css # Информация о теме

functions.php # Подключение файлов и основные функции

index.php # Главный шаблон

single-doctors.php # Шаблон одиночной записи врача

archive-doctors.php # Шаблон архива с фильтрами

README.md # Документация

includes/

cpt-doctors.php # Регистрация типа записей

taxonomies.php # Таксономии (специализации, города)

meta-boxes.php # Мета-поля (стаж, цена, рейтинг)

filters.php # Логика фильтрации (pre_get_posts)

helper-functions.php # Вспомогательные функции

assets/

css/doctors-style.css # Стили

js/doctors-filters.js # JavaScript для фильтров

## Функционал

### Кастомный тип записей: Доктор

- **Slug**: `doctors`
- **Архив**: `/doctors/`
- **Одиночная запись**: `/doctors/ivanov/`
- **Поддерживает**: Заголовок, редактор, миниатюру, отрывок
- **Иконка**: Dashicons в админке

### Таксономии

1. **Специализация** (`specialization`) - иерархическая
    - Как категории, может иметь вложенность
    - URL: `/specialization/hirurgiya/`
    - Подходит для организации специальностей с подкатегориями

2. **Город** (`city`) - иерархическая
    - Как категории, может иметь вложенность
    - URL: `/city/moskva/`
    - **Выбор обоснован**: Города имеют иерархии, удобнее для выбора

### Мета-поля врача (в админке)

В каждой записи "Доктор" добавлены 3 поля:

- **Стаж врача** (лет) - число 0-70
- **Цена от** (руб) - минимальная стоимость приема
- **Рейтинг** (0-5) - с шагом 0.1

Реализовано через нативные мета-боксы (без плагинов).

### Альтернатива с ACF (по желанию)

Если хотите использовать ACF:

1. Создайте групу полей "Детали врача"
2. Добавьте 3 поля типа Number:
    - `experience` (Стаж)
    - `price` (Цена от)
    - `rating` (Рейтинг)
3. Установите правило отображения: Post Type = doctors
4. Измените префикс в `includes/helper-functions.php` с `_md_doctor_` на `field_`

### Шаблоны

- **Одиночная запись** (`single-doctors.php`):
    - Выводит все данные врача
    - Миниатюра, мета-поля, таксономии
    - Ссылка "← Назад к списку врачей"

- **Архив** (`archive-doctors.php`):
    - Сетка карточек врачей (3 колонки)
    - Фильтры по специализации, городу и сортировка
    - Пагинация (9 элементов на страницу)

### Фильтрация на архиве

Работает через GET-параметры, сохраняются все выбранные значения при переключении страниц.

**Доступные параметры:**

- `specialization` - фильтр по специализации (slug)
- `city` - фильтр по городу (slug)
- `sort` - сортировка:
    - `rating` - по рейтингу (по убыванию)
    - `price_asc` - по цене (по возрастанию)
    - `experience` - по стажу (по убыванию)

**Пример URL:**
`/doctors/?specialization=hirurgiya&city=moskva&sort=rating`

## Тестовые URL

После создания записей:

| Страница            | URL                                             |
|---------------------|-------------------------------------------------|
| Архив врачей        | `http://yoursite.com/doctors/`                  |
| Страница врача      | `http://yoursite.com/doctors/ivanov/`           |
| Архив специализации | `http://yoursite.com/specialization/hirurgiya/` |
| Архив города        | `http://yoursite.com/city/moskva/`              |

## Создание тестовых данных

### 1. Добавить специализации

Перейдите в **Докторы → Специализации** и создайте:

- Хирургия
- Кардиология
- Педиатрия
- Неврология

### 2. Добавить города

Перейдите в **Докторы → Города** и создайте:

- Москва
- Санкт-Петербург
- Новосибирск
- Екатеринбург

### 3. Добавить врачей

Перейдите в **Докторы → Добавить нового** и создайте 10+ записей:

**Пример заполнения:**

- Заголовок: Доктор Иванов Иван
- Специализация: Хирургия
- Город: Москва
- Стаж врача: 15
- Цена от: 3000
- Рейтинг: 4.5
- Добавьте миниатюру и отрывок

**Важно**: Создайте минимум 10 врачей, чтобы проверить пагинацию (9 элементов на страницу).

## Технические решения

### Выбор pre_get_posts vs WP_Query

**Использован pre_get_posts** в `includes/filters.php` по следующим причинам:

- Автоматическая работа пагинации
- Сохранение иерархии шаблонов WordPress
- Лучшая производительность (один запрос вместо двух)
- Простота поддержки

**Альтернатива**: Можно было использовать `WP_Query` прямо в `archive-doctors.php`, но требовалась бы ручная обработка
пагинации через `paginate_links()` и сохранение GET-параметров.

### Санитизация и безопасность

Все пользовательские данные обрабатываются:

- `sanitize_text_field()` - для строк
- `absint()` - для целых чисел (цена, стаж)
- `floatval()` + ограничение 0-5 - для рейтинга
- `esc_html()`, `esc_url()`, `esc_attr()` - для вывода
- `wp_kses_post()` - для безопасного вывода HTML (рейтинг со звездочками)

### Архитектура кода

Код структурирован по принципу единой ответственности:

- `cpt-doctors.php` - только регистрация CPT
- `taxonomies.php` - только таксономии
- `meta-boxes.php` - только мета-поля
- `filters.php` - только фильтрация запросов
- `helper-functions.php` - повторяемые функции

### JavaScript

Использован ванильный JavaScript (без jQuery) в `assets/js/doctors-filters.js`:

- Сохраняет фильтры при переходе по пагинации
- Минимальный и современный код
- Работает во всех современных браузерах

## Кастомизация

Все стили находятся в `assets/css/doctors-style.css`. Основные переменные:

- `--primary-color`: #0073aa (синий WordPress)
- `--accent-color`: #dc3232 (красный для сброса)
- `--border-radius`: 8px
- `--grid-gap`: 30px

---

**Готово к сдаче!** Тема соответствует всем требованиям тестового задания:

- Кастомный тип записей
- 2 таксономии с правильной структурой
- 3 мета-поля
- Шаблоны single и archive
- Фильтрация и сортировка через GET
- Пагинация (9 элементов)
- Чистый код с санитизацией
- Структурированные функции
- pre_get_posts
- Подробный README на русском